(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-763e1edf"],{"05bf":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"room"},[n("div",{ref:"video-box",staticClass:"video-box"},[n("video",{ref:"video-mine",staticClass:"video-mine",attrs:{autoplay:"",controls:""}})])])},i=[],a=(n("55dd"),n("ac6a"),n("29b2")),c={name:"home",data:function(){return{roomid:"",peer:null,peerList:{},candidate:null,localStream:null}},watch:{userList:{handler:function(){},deep:!0}},beforeDestroy:function(){for(var t in this.peerList)this.peerList[t].close(),this.peerList[t]=null},methods:{getUserMedia:function(){var t=this,e=this.$refs["video-mine"],n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return new Promise(function(o,i){n.call(navigator,{audio:!0,video:!0},function(n){e.srcObject=n,t.localStream=n,o()},function(t){i(t)})})},getPeerConnection:function(t){var e=this,n=this.$refs["video-box"],o={iceServers:[{url:"stun:stun.l.google.com:19302"}]},i=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,c=new i(o);c.addStream(this.localStream),c.onaddstream=function(e){var o=document.querySelector("#"+t.account);if(o)o.srcObject=e.stream;else{var i=document.createElement("video");i.controls=!0,i.autoplay="autoplay",i.srcObject=e.stream,i.id=t.account,n.append(i)}},c.onicecandidate=function(n){n.candidate&&a["a"].emit("__ice_candidate",{candidate:n.candidate,roomid:e.$route.params.roomid,account:t.account})},this.peerList[t.account]=c},createOffer:function(t,e){var n=this;e.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then(function(o){e.setLocalDescription(o,function(){a["a"].emit("offer",{sdp:e.localDescription,roomid:n.$route.params.roomid,account:t})})})},socketInit:function(){var t=this;a["a"].on("offer",function(e){t.peerList[e.account]&&t.peerList[e.account].setRemoteDescription(e.sdp,function(){t.peerList[e.account].createAnswer().then(function(n){t.peerList[e.account].setLocalDescription(n,function(){a["a"].emit("answer",{sdp:t.peerList[e.account].localDescription,roomid:t.$route.params.roomid,account:e.account})})})},function(){})}),a["a"].on("answer",function(e){console.log("take_answer",e.sdp),t.peerList[e.account]&&t.peerList[e.account].setRemoteDescription(e.sdp,function(){},function(){})}),a["a"].on("__ice_candidate",function(e){e.candidate&&t.peerList[e.account]&&t.peerList[e.account].addIceCandidate(e.candidate).catch(function(){})}),a["a"].on("disconnected",function(t){var e=document.querySelector("#"+t);e&&e.remove()})}},mounted:function(){var t=this;this.$nextTick(function(){t.getUserMedia().then(function(){a["a"].emit("join",{roomid:t.$route.params.roomid,account:t.$route.params.account})}),t.socketInit(),a["a"].on("joined",function(e,n){if(console.log("joined",e),e.length>1&&(e.forEach(function(e){var n={},o=[e.account,t.$route.params.account];n.account=o.sort().join("-"),t.peerList[n.account]||e.account===t.$route.params.account||t.getPeerConnection(n)}),n===t.$route.params.account))for(var o in t.peerList)t.createOffer(o,t.peerList[o])})})}},r=c,s=(n("84da"),n("2877")),u=Object(s["a"])(r,o,i,!1,null,null,null);u.options.__file="room.vue";e["default"]=u.exports},"2f21":function(t,e,n){"use strict";var o=n("79e5");t.exports=function(t,e){return!!t&&o(function(){e?t.call(null,function(){},1):t.call(null)})}},"55dd":function(t,e,n){"use strict";var o=n("5ca1"),i=n("d8e8"),a=n("4bf8"),c=n("79e5"),r=[].sort,s=[1,2,3];o(o.P+o.F*(c(function(){s.sort(void 0)})||!c(function(){s.sort(null)})||!n("2f21")(r)),"Array",{sort:function(t){return void 0===t?r.call(a(this)):r.call(a(this),i(t))}})},"836f":function(t,e,n){},"84da":function(t,e,n){"use strict";var o=n("836f"),i=n.n(o);i.a},ac6a:function(t,e,n){for(var o=n("cadf"),i=n("0d58"),a=n("2aba"),c=n("7726"),r=n("32e9"),s=n("84f2"),u=n("2b4c"),d=u("iterator"),l=u("toStringTag"),f=s.Array,m={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(m),L=0;L<p.length;L++){var v,h=p[L],S=m[h],g=c[h],w=g&&g.prototype;if(w&&(w[d]||r(w,d,f),w[l]||r(w,l,h),s[h]=f,S))for(v in o)w[v]||a(w,v,o[v],!0)}}}]);